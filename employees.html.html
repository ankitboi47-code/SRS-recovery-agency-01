<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Swastik Recovery Services - Employee Management</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --cream: #F5F5DC;
            --dark-cream: #E8E5D5;
            --grey: #6B7280;
            --dark-grey: #4B5563;
            --light-grey: #F3F4F6;
        }
        
        body {
            background: linear-gradient(135deg, #F5F5DC 0%, #E8E5D5 50%, #F3F4F6 100%);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .glass-card {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(107, 114, 128, 0.1);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #6B7280 0%, #4B5563 100%);
            transition: all 0.3s ease;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(107, 114, 128, 0.3);
        }
        
        .employee-card {
            transition: all 0.3s ease;
            border-left: 4px solid #6B7280;
        }
        
        .employee-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(107, 114, 128, 0.2);
        }
        
        .tab-btn {
            transition: all 0.3s ease;
        }
        
        .tab-btn.active {
            background: linear-gradient(135deg, #6B7280 0%, #4B5563 100%);
            color: white;
        }
        
        .progress-bar {
            background: linear-gradient(90deg, #6B7280 0%, #4B5563 100%);
        }
        
        .file-upload-area {
            border: 2px dashed #6B7280;
            transition: all 0.3s ease;
        }
        
        .file-upload-area:hover {
            border-color: #4B5563;
            background: rgba(107, 114, 128, 0.05);
        }
    </style>
</head>
<body class="min-h-screen p-4 md:p-8">
    
    <!-- Header -->
    <header class="glass-card rounded-2xl shadow-xl p-6 md:p-8 mb-8">
        <div class="flex flex-col md:flex-row justify-between items-center">
            <div>
                <h1 class="text-3xl md:text-4xl font-bold text-gray-800 mb-2">
                    üè¢ Swastik Recovery Services
                </h1>
                <p class="text-gray-600 text-sm md:text-base">
                    üìç Betel Leaf Shop, Harishanakarpur, Siddhathpuram Colony,<br class="hidden md:block"> Mughalsarai, Chandauli - 232101
                </p>
            </div>
            <div class="mt-4 md:mt-0">
                <div class="text-right">
                    <p class="text-2xl font-bold text-gray-700" id="totalEmployees">0</p>
                    <p class="text-sm text-gray-500">Total Employees</p>
                </div>
            </div>
        </div>
    </header>

    <!-- Navigation Tabs -->
    <div class="glass-card rounded-2xl shadow-xl p-4 mb-8">
        <div class="flex flex-wrap gap-2 md:gap-4">
            <button class="tab-btn active px-6 py-3 rounded-xl font-semibold" onclick="switchTab('dashboard')">
                üìä Dashboard
            </button>
            <button class="tab-btn px-6 py-3 rounded-xl font-semibold text-gray-700" onclick="switchTab('addEmployee')">
                ‚ûï Add Employee
            </button>
            <button class="tab-btn px-6 py-3 rounded-xl font-semibold text-gray-700" onclick="switchTab('employees')">
                üë• Employees
            </button>
            <button class="tab-btn px-6 py-3 rounded-xl font-semibold text-gray-700" onclick="switchTab('progress')">
                üìà Progress Chart
            </button>
        </div>
    </div>

    <!-- Main Content -->
    <div id="content">
        
        <!-- Dashboard Tab -->
        <div id="dashboardTab" class="tab-content">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="glass-card rounded-2xl shadow-xl p-6">
                    <h3 class="text-lg font-semibold text-gray-700 mb-2">Total Employees</h3>
                    <p class="text-4xl font-bold text-gray-800" id="dashTotalEmployees">0</p>
                </div>
                <div class="glass-card rounded-2xl shadow-xl p-6">
                    <h3 class="text-lg font-semibold text-gray-700 mb-2">Active Tasks</h3>
                    <p class="text-4xl font-bold text-gray-800" id="activeTasks">0</p>
                </div>
                <div class="glass-card rounded-2xl shadow-xl p-6">
                    <h3 class="text-lg font-semibold text-gray-700 mb-2">Uploaded Files</h3>
                    <p class="text-4xl font-bold text-gray-800" id="totalFiles">0</p>
                </div>
            </div>
            
            <div class="glass-card rounded-2xl shadow-xl p-6">
                <h2 class="text-2xl font-bold text-gray-800 mb-6">Recent Employees</h2>
                <div id="recentEmployees" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    <p class="text-gray-500 col-span-full text-center py-8">No employees added yet</p>
                </div>
            </div>
        </div>

        <!-- Add Employee Tab -->
        <div id="addEmployeeTab" class="tab-content hidden">
            <div class="glass-card rounded-2xl shadow-xl p-6 md:p-8 max-w-3xl mx-auto">
                <h2 class="text-2xl font-bold text-gray-800 mb-6">Add New Employee</h2>
                <form id="employeeForm" class="space-y-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-gray-700 font-semibold mb-2">Full Name *</label>
                            <input type="text" id="empName" required class="w-full px-4 py-3 rounded-xl border border-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-500">
                        </div>
                        <div>
                            <label class="block text-gray-700 font-semibold mb-2">Employee ID *</label>
                            <input type="text" id="empId" required class="w-full px-4 py-3 rounded-xl border border-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-500">
                        </div>
                        <div>
                            <label class="block text-gray-700 font-semibold mb-2">Email *</label>
                            <input type="email" id="empEmail" required class="w-full px-4 py-3 rounded-xl border border-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-500">
                        </div>
                        <div>
                            <label class="block text-gray-700 font-semibold mb-2">Phone *</label>
                            <input type="tel" id="empPhone" required class="w-full px-4 py-3 rounded-xl border border-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-500">
                        </div>
                        <div>
                            <label class="block text-gray-700 font-semibold mb-2">Position *</label>
                            <input type="text" id="empPosition" required class="w-full px-4 py-3 rounded-xl border border-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-500">
                        </div>
                        <div>
                            <label class="block text-gray-700 font-semibold mb-2">Department *</label>
                            <select id="empDepartment" required class="w-full px-4 py-3 rounded-xl border border-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-500">
                                <option value="">Select Department</option>
                                <option value="Recovery">Recovery</option>
                                <option value="Collections">Collections</option>
                                <option value="Operations">Operations</option>
                                <option value="Administration">Administration</option>
                                <option value="IT">IT</option>
                            </select>
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-gray-700 font-semibold mb-2">Address</label>
                        <textarea id="empAddress" rows="3" class="w-full px-4 py-3 rounded-xl border border-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-500"></textarea>
                    </div>
                    
                    <div>
                        <label class="block text-gray-700 font-semibold mb-2">Employee Photo</label>
                        <input type="file" id="empPhoto" accept="image/*" class="w-full px-4 py-3 rounded-xl border border-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-500">
                        <img id="photoPreview" class="mt-4 rounded-xl max-w-xs hidden" />
                    </div>
                    
                    <button type="submit" class="btn-primary w-full py-4 rounded-xl text-white font-bold text-lg shadow-lg">
                        Add Employee
                    </button>
                </form>
            </div>
        </div>

        <!-- Employees Tab -->
        <div id="employeesTab" class="tab-content hidden">
            <div class="glass-card rounded-2xl shadow-xl p-6">
                <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4">
                    <h2 class="text-2xl font-bold text-gray-800">All Employees</h2>
                    <input type="text" id="searchEmployee" placeholder="Search employees..." class="px-4 py-2 rounded-xl border border-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-500">
                </div>
                <div id="employeesList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <p class="text-gray-500 col-span-full text-center py-8">No employees found</p>
                </div>
            </div>
        </div>

        <!-- Progress Chart Tab -->
        <div id="progressTab" class="tab-content hidden">
            <div class="glass-card rounded-2xl shadow-xl p-6 mb-6">
                <h2 class="text-2xl font-bold text-gray-800 mb-6">Employee Progress Overview</h2>
                <canvas id="progressChart" class="w-full" style="max-height: 400px;"></canvas>
            </div>
            
            <div class="glass-card rounded-2xl shadow-xl p-6">
                <h2 class="text-2xl font-bold text-gray-800 mb-6">Individual Progress</h2>
                <div id="individualProgress" class="space-y-4">
                    <p class="text-gray-500 text-center py-8">No employee data available</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Employee Detail Modal -->
    <div id="employeeModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50 p-4">
        <div class="glass-card rounded-2xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto">
            <div class="p-6 md:p-8">
                <div class="flex justify-between items-start mb-6">
                    <h2 class="text-2xl font-bold text-gray-800">Employee Details</h2>
                    <button onclick="closeModal()" class="text-gray-500 hover:text-gray-700 text-2xl">‚úï</button>
                </div>
                
                <div id="modalContent"></div>
            </div>
        </div>
    </div>

    <script>
        let employees = JSON.parse(localStorage.getItem('employees')) || [];
        let progressChart = null;

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            updateDashboard();
            renderRecentEmployees();
            renderEmployeesList();
            updateProgressChart();
            
            // Photo preview
            document.getElementById('empPhoto').addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const preview = document.getElementById('photoPreview');
                        preview.src = e.target.result;
                        preview.classList.remove('hidden');
                    };
                    reader.readAsDataURL(file);
                }
            });
            
            // Search functionality
            document.getElementById('searchEmployee').addEventListener('input', function(e) {
                renderEmployeesList(e.target.value);
            });
        });

        // Switch tabs
        function switchTab(tabName) {
            const tabs = document.querySelectorAll('.tab-content');
            const btns = document.querySelectorAll('.tab-btn');
            
            tabs.forEach(tab => tab.classList.add('hidden'));
            btns.forEach(btn => {
                btn.classList.remove('active');
                btn.classList.add('text-gray-700');
            });
            
            document.getElementById(tabName + 'Tab').classList.remove('hidden');
            event.target.classList.add('active');
            event.target.classList.remove('text-gray-700');
            
            if (tabName === 'progress') {
                updateProgressChart();
            }
        }

        // Add employee form submission
        document.getElementById('employeeForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const photoInput = document.getElementById('empPhoto');
            let photoData = null;
            
            if (photoInput.files[0]) {
                photoData = await fileToBase64(photoInput.files[0]);
            }
            
            const employee = {
                id: Date.now(),
                name: document.getElementById('empName').value,
                empId: document.getElementById('empId').value,
                email: document.getElementById('empEmail').value,
                phone: document.getElementById('empPhone').value,
                position: document.getElementById('empPosition').value,
                department: document.getElementById('empDepartment').value,
                address: document.getElementById('empAddress').value,
                photo: photoData,
                tasks: [],
                files: [],
                progress: 0,
                createdAt: new Date().toISOString()
            };
            
            employees.push(employee);
            localStorage.setItem('employees', JSON.stringify(employees));
            
            alert('Employee added successfully!');
            this.reset();
            document.getElementById('photoPreview').classList.add('hidden');
            
            updateDashboard();
            renderRecentEmployees();
            renderEmployeesList();
            updateProgressChart();
        });

        // File to base64
        function fileToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => resolve(reader.result);
                reader.onerror = reject;
                reader.readAsDataURL(file);
            });
        }

        // Update dashboard
        function updateDashboard() {
            const totalEmployees = employees.length;
            const activeTasks = employees.reduce((sum, emp) => sum + emp.tasks.filter(t => !t.completed).length, 0);
            const totalFiles = employees.reduce((sum, emp) => sum + emp.files.length, 0);
            
            document.getElementById('totalEmployees').textContent = totalEmployees;
            document.getElementById('dashTotalEmployees').textContent = totalEmployees;
            document.getElementById('activeTasks').textContent = activeTasks;
            document.getElementById('totalFiles').textContent = totalFiles;
        }

        // Render recent employees
        function renderRecentEmployees() {
            const container = document.getElementById('recentEmployees');
            const recent = employees.slice(-6).reverse();
            
            if (recent.length === 0) {
                container.innerHTML = '<p class="text-gray-500 col-span-full text-center py-8">No employees added yet</p>';
                return;
            }
            
            container.innerHTML = recent.map(emp => `
                <div class="employee-card glass-card rounded-xl p-4 cursor-pointer" onclick="openEmployeeDetail(${emp.id})">
                    <div class="flex items-center gap-4">
                        <div class="w-16 h-16 rounded-full bg-gray-200 flex items-center justify-center overflow-hidden">
                            ${emp.photo ? `<img src="${emp.photo}" alt="${emp.name}" class="w-full h-full object-cover">` : `<span class="text-2xl">${emp.name.charAt(0)}</span>`}
                        </div>
                        <div class="flex-1">
                            <h3 class="font-bold text-gray-800">${emp.name}</h3>
                            <p class="text-sm text-gray-600">${emp.position}</p>
                            <p class="text-xs text-gray-500">${emp.department}</p>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Render employees list
        function renderEmployeesList(searchTerm = '') {
            const container = document.getElementById('employeesList');
            let filtered = employees;
            
            if (searchTerm) {
                filtered = employees.filter(emp => 
                    emp.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
                    emp.empId.toLowerCase().includes(searchTerm.toLowerCase()) ||
                    emp.department.toLowerCase().includes(searchTerm.toLowerCase())
                );
            }
            
            if (filtered.length === 0) {
                container.innerHTML = '<p class="text-gray-500 col-span-full text-center py-8">No employees found</p>';
                return;
            }
            
            container.innerHTML = filtered.map(emp => `
                <div class="employee-card glass-card rounded-xl p-6 cursor-pointer" onclick="openEmployeeDetail(${emp.id})">
                    <div class="flex flex-col items-center text-center">
                        <div class="w-24 h-24 rounded-full bg-gray-200 flex items-center justify-center overflow-hidden mb-4">
                            ${emp.photo ? `<img src="${emp.photo}" alt="${emp.name}" class="w-full h-full object-cover">` : `<span class="text-4xl">${emp.name.charAt(0)}</span>`}
                        </div>
                        <h3 class="font-bold text-gray-800 text-lg mb-1">${emp.name}</h3>
                        <p class="text-sm text-gray-600 mb-1">${emp.position}</p>
                        <p class="text-xs text-gray-500 mb-3">${emp.department}</p>
                        <div class="w-full bg-gray-200 rounded-full h-2 mb-2">
                            <div class="progress-bar h-2 rounded-full" style="width: ${emp.progress}%"></div>
                        </div>
                        <p class="text-xs text-gray-600">${emp.progress}% Complete</p>
                        <div class="mt-3 flex gap-2 text-xs">
                            <span class="bg-gray-100 px-2 py-1 rounded">üìã ${emp.tasks.length} tasks</span>
                            <span class="bg-gray-100 px-2 py-1 rounded">üìÅ ${emp.files.length} files</span>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Open employee detail modal
        function openEmployeeDetail(empId) {
            const employee = employees.find(e => e.id === empId);
            if (!employee) return;
            
            const modal = document.getElementById('employeeModal');
            const content = document.getElementById('modalContent');
            
            content.innerHTML = `
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                    <div class="md:col-span-1 flex flex-col items-center">
                        <div class="w-32 h-32 rounded-full bg-gray-200 flex items-center justify-center overflow-hidden mb-4">
                            ${employee.photo ? `<img src="${employee.photo}" alt="${employee.name}" class="w-full h-full object-cover">` : `<span class="text-5xl">${employee.name.charAt(0)}</span>`}
                        </div>
                        <h3 class="font-bold text-gray-800 text-xl mb-1">${employee.name}</h3>
                        <p class="text-gray-600">${employee.position}</p>
                        <p class="text-sm text-gray-500">${employee.department}</p>
                    </div>
                    
                    <div class="md:col-span-2 space-y-3">
                        <div>
                            <p class="text-sm text-gray-500">Employee ID</p>
                            <p class="font-semibold text-gray-800">${employee.empId}</p>
                        </div>
                        <div>
                            <p class="text-sm text-gray-500">Email</p>
                            <p class="font-semibold text-gray-800">${employee.email}</p>
                        </div>
                        <div>
                            <p class="text-sm text-gray-500">Phone</p>
                            <p class="font-semibold text-gray-800">${employee.phone}</p>
                        </div>
                        <div>
                            <p class="text-sm text-gray-500">Address</p>
                            <p class="font-semibold text-gray-800">${employee.address || 'N/A'}</p>
                        </div>
                    </div>
                </div>
                
                <!-- Progress -->
                <div class="mb-6">
                    <div class="flex justify-between mb-2">
                        <p class="font-semibold text-gray-700">Overall Progress</p>
                        <p class="font-semibold text-gray-700">${employee.progress}%</p>
                    </div>
                    <div class="w-full bg-gray-200 rounded-full h-3">
                        <div class="progress-bar h-3 rounded-full" style="width: ${employee.progress}%"></div>
                    </div>
                    <div class="mt-2">
                        <input type="range" min="0" max="100" value="${employee.progress}" 
                            onchange="updateEmployeeProgress(${employee.id}, this.value)"
                            class="w-full">
                    </div>
                </div>
                
                <!-- Upload Excel File -->
                <div class="mb-6">
                    <h3 class="font-bold text-gray-800 text-lg mb-3">üìä Upload Excel File</h3>
                    <div class="file-upload-area rounded-xl p-6 text-center">
                        <input type="file" id="excelFile${employee.id}" accept=".xlsx,.xls,.csv" class="hidden" onchange="uploadExcelFile(${employee.id}, this)">
                        <label for="excelFile${employee.id}" class="cursor-pointer">
                            <div class="text-4xl mb-2">üìÅ</div>
                            <p class="text-gray-700 font-semibold mb-1">Click to upload Excel file</p>
                            <p class="text-sm text-gray-500">Supports .xlsx, .xls, .csv files</p>
                        </label>
                    </div>
                    
                    ${employee.files.length > 0 ? `
                        <div class="mt-4 space-y-2">
                            <h4 class="font-semibold text-gray-700">Uploaded Files:</h4>
                            ${employee.files.map((file, idx) => `
                                <div class="flex items-center justify-between bg-gray-50 p-3 rounded-lg">
                                    <div class="flex items-center gap-3">
                                        <span class="text-2xl">üìÑ</span>
                                        <div>
                                            <p class="font-semibold text-gray-800">${file.name}</p>
                                            <p class="text-xs text-gray-500">${new Date(file.uploadedAt).toLocaleString()}</p>
                                        </div>
                                    </div>
                                    <div class="flex gap-2">
                                        <button onclick="downloadFile(${employee.id}, ${idx})" class="px-3 py-1 bg-gray-600 text-white rounded-lg text-sm hover:bg-gray-700">
                                            Download
                                        </button>
                                        <button onclick="deleteFile(${employee.id}, ${idx})" class="px-3 py-1 bg-red-600 text-white rounded-lg text-sm hover:bg-red-700">
                                            Delete
                                        </button>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    ` : ''}
                </div>
                
                <!-- Assign Task -->
                <div class="mb-6">
                    <h3 class="font-bold text-gray-800 text-lg mb-3">‚úÖ Assign Task</h3>
                    <div class="flex gap-2">
                        <input type="text" id="taskInput${employee.id}" placeholder="Enter task description..." 
                            class="flex-1 px-4 py-2 rounded-xl border border-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-500">
                        <button onclick="assignTask(${employee.id})" class="btn-primary px-6 py-2 rounded-xl text-white font-semibold">
                            Add Task
                        </button>
                    </div>
                    
                    ${employee.tasks.length > 0 ? `
                        <div class="mt-4 space-y-2">
                            ${employee.tasks.map((task, idx) => `
                                <div class="flex items-center justify-between bg-gray-50 p-3 rounded-lg ${task.completed ? 'opacity-60' : ''}">
                                    <div class="flex items-center gap-3">
                                        <input type="checkbox" ${task.completed ? 'checked' : ''} 
                                            onchange="toggleTask(${employee.id}, ${idx})"
                                            class="w-5 h-5 cursor-pointer">
                                        <span class="${task.completed ? 'line-through text-gray-500' : 'text-gray-800'}">${task.description}</span>
                                    </div>
                                    <button onclick="deleteTask(${employee.id}, ${idx})" class="text-red-600 hover:text-red-800">
                                        üóëÔ∏è
                                    </button>
                                </div>
                            `).join('')}
                        </div>
                    ` : '<p class="text-gray-500 text-sm mt-3">No tasks assigned yet</p>'}
                </div>
                
                <div class="flex gap-2">
                    <button onclick="deleteEmployee(${employee.id})" class="flex-1 py-3 bg-red-600 text-white rounded-xl font-semibold hover:bg-red-700">
                        Delete Employee
                    </button>
                    <button onclick="closeModal()" class="flex-1 py-3 bg-gray-600 text-white rounded-xl font-semibold hover:bg-gray-700">
                        Close
                    </button>
                </div>
            `;
            
            modal.classList.remove('hidden');
            modal.classList.add('flex');
        }

        // Upload Excel file
        async function uploadExcelFile(empId, input) {
            const file = input.files[0];
            if (!file) return;
            
            const employee = employees.find(e => e.id === empId);
            if (!employee) return;
            
            const fileData = await fileToBase64(file);
            
            employee.files.push({
                name: file.name,
                data: fileData,
                type: file.type,
                size: file.size,
                uploadedAt: new Date().toISOString()
            });
            
            localStorage.setItem('employees', JSON.stringify(employees));
            updateDashboard();
            openEmployeeDetail(empId);
            alert('File uploaded successfully!');
        }

        // Download file
        function downloadFile(empId, fileIdx) {
            const employee = employees.find(e => e.id === empId);
            if (!employee) return;
            
            const file = employee.files[fileIdx];
            const link = document.createElement('a');
            link.href = file.data;
            link.download = file.name;
            link.click();
        }

        // Delete file
        function deleteFile(empId, fileIdx) {
            if (!confirm('Are you sure you want to delete this file?')) return;
            
            const employee = employees.find(e => e.id === empId);
            if (!employee) return;
            
            employee.files.splice(fileIdx, 1);
            localStorage.setItem('employees', JSON.stringify(employees));
            updateDashboard();
            openEmployeeDetail(empId);
        }

        // Assign task
        function assignTask(empId) {
            const input = document.getElementById(`taskInput${empId}`);
            const description = input.value.trim();
            
            if (!description) {
                alert('Please enter a task description');
                return;
            }
            
            const employee = employees.find(e => e.id === empId);
            if (!employee) return;
            
            employee.tasks.push({
                description,
                completed: false,
                createdAt: new Date().toISOString()
            });
            
            localStorage.setItem('employees', JSON.stringify(employees));
            updateDashboard();
            openEmployeeDetail(empId);
        }

        // Toggle task
        function toggleTask(empId, taskIdx) {
            const employee = employees.find(e => e.id === empId);
            if (!employee) return;
            
            employee.tasks[taskIdx].completed = !employee.tasks[taskIdx].completed;
            localStorage.setItem('employees', JSON.stringify(employees));
            updateDashboard();
            openEmployeeDetail(empId);
        }

        // Delete task
        function deleteTask(empId, taskIdx) {
            const employee = employees.find(e => e.id === empId);
            if (!employee) return;
            
            employee.tasks.splice(taskIdx, 1);
            localStorage.setItem('employees', JSON.stringify(employees));
            updateDashboard();
            openEmployeeDetail(empId);
        }

        // Update employee progress
        function updateEmployeeProgress(empId, progress) {
            const employee = employees.find(e => e.id === empId);
            if (!employee) return;
            
            employee.progress = parseInt(progress);
            localStorage.setItem('employees', JSON.stringify(employees));
            updateProgressChart();
            openEmployeeDetail(empId);
        }

        // Delete employee
        function deleteEmployee(empId) {
            if (!confirm('Are you sure you want to delete this employee?')) return;
            
            employees = employees.filter(e => e.id !== empId);
            localStorage.setItem('employees', JSON.stringify(employees));
            
            closeModal();
            updateDashboard();
            renderRecentEmployees();
            renderEmployeesList();
            updateProgressChart();
            
            alert('Employee deleted successfully!');
        }

        // Close modal
        function closeModal() {
            const modal = document.getElementById('employeeModal');
            modal.classList.add('hidden');
            modal.classList.remove('flex');
        }

        // Update progress chart
        function updateProgressChart() {
            const ctx = document.getElementById('progressChart');
            if (!ctx) return;
            
            const individualContainer = document.getElementById('individualProgress');
            
            if (employees.length === 0) {
                if (progressChart) {
                    progressChart.destroy();
                    progressChart = null;
                }
                individualContainer.innerHTML = '<p class="text-gray-500 text-center py-8">No employee data available</p>';
                return;
            }
            
            // Chart
            const chartData = {
                labels: employees.map(e => e.name),
                datasets: [{
                    label: 'Progress (%)',
                    data: employees.map(e => e.progress),
                    backgroundColor: 'rgba(107, 114, 128, 0.6)',
                    borderColor: 'rgba(75, 85, 99, 1)',
                    borderWidth: 2
                }]
            };
            
            if (progressChart) {
                progressChart.destroy();
            }
            
            progressChart = new Chart(ctx, {
                type: 'bar',
                data: chartData,
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100
                        }
                    }
                }
            });
            
            // Individual progress
            individualContainer.innerHTML = employees.map(emp => `
                <div class="bg-gray-50 rounded-xl p-4">
                    <div class="flex items-center justify-between mb-2">
                        <div class="flex items-center gap-3">
                            <div class="w-12 h-12 rounded-full bg-gray-200 flex items-center justify-center overflow-hidden">
                                ${emp.photo ? `<img src="${emp.photo}" alt="${emp.name}" class="w-full h-full object-cover">` : `<span class="text-lg">${emp.name.charAt(0)}</span>`}
                            </div>
                            <div>
                                <p class="font-semibold text-gray-800">${emp.name}</p>
                                <p class="text-sm text-gray-500">${emp.position}</p>
                            </div>
                        </div>
                        <p class="font-bold text-gray-800 text-lg">${emp.progress}%</p>
                    </div>
                    <div class="w-full bg-gray-200 rounded-full h-2">
                        <div class="progress-bar h-2 rounded-full" style="width: ${emp.progress}%"></div>
                    </div>
                    <div class="mt-2 flex gap-3 text-xs text-gray-600">
                        <span>üìã ${emp.tasks.filter(t => t.completed).length}/${emp.tasks.length} tasks completed</span>
                        <span>üìÅ ${emp.files.length} files</span>
                    </div>
                </div>
            `).join('');
        }
    </script>

</body>
</html>